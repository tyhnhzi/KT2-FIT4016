@page
@model PickleballClub.Pages.Challenges.CreateModel
@using PickleballClub.Models

@{
    ViewData["Title"] = "Tạo Kèo mới";
}

<div class="glass-card mt-4 mx-auto fade-in-up" style="max-width: 800px;">
    <h2 class="mb-4 text-center font-weight-bold">Tạo Kèo đấu mới</h2>
    
    <form method="post">
        <div asp-validation-summary="ModelOnly" class="text-danger mb-4"></div>

        <div class="mb-4">
            <label asp-for="Challenge.Title" class="form-label small text-uppercase opacity-75">Tiêu đề kèo</label>
            <input asp-for="Challenge.Title" class="form-control" placeholder="Ví dụ: Solo tranh cúp, Mini game cuối tuần..." />
            <span asp-validation-for="Challenge.Title" class="text-danger"></span>
        </div>

        <div class="mb-4">
            <label asp-for="Challenge.Description" class="form-label small text-uppercase opacity-75">Mô tả chi tiết</label>
            <textarea asp-for="Challenge.Description" class="form-control" rows="3" placeholder="Ghi chú về thời gian, địa điểm, luật chơi..."></textarea>
            <span asp-validation-for="Challenge.Description" class="text-danger"></span>
        </div>

        <div class="row">
            <div class="col-md-4 mb-4">
                <label asp-for="Challenge.Type" class="form-label small text-uppercase opacity-75">Loại Kèo</label>
                <select asp-for="Challenge.Type" class="form-select" id="type-select" asp-items="Html.GetEnumSelectList<ChallengeType>()">
                </select>
                <span asp-validation-for="Challenge.Type" class="text-danger"></span>
            </div>
            <div class="col-md-4 mb-4">
                <label asp-for="Challenge.GameMode" class="form-label small text-uppercase opacity-75">Thể thức</label>
                <select asp-for="Challenge.GameMode" class="form-select" asp-items="Html.GetEnumSelectList<ChallengeGameMode>()">
                </select>
                <span asp-validation-for="Challenge.GameMode" class="text-danger"></span>
            </div>
            <div class="col-md-4 mb-4">
                <label asp-for="Challenge.EntryFee" class="form-label small text-uppercase opacity-75">Lệ phí (nếu có)</label>
                <div class="input-group">
                    <input asp-for="Challenge.EntryFee" type="number" class="form-control border-end-0" id="entry-fee" value="0" style="border-top-right-radius: 0 !important; border-bottom-right-radius: 0 !important;" />
                    <span class="input-group-text bg-transparent border-secondary text-white-50 px-3" style="border-left: none; border-top-left-radius: 0 !important; border-bottom-left-radius: 0 !important;">đ</span>
                </div>
                <span asp-validation-for="Challenge.EntryFee" class="text-danger"></span>
            </div>
        </div>

        <div class="mb-4">
            <label asp-for="Challenge.RewardDescription" class="form-label small text-uppercase opacity-75">Phần thưởng / Kèo</label>
            <input asp-for="Challenge.RewardDescription" class="form-control" placeholder="1 thùng nước, 500k, hoặc kỉ niệm..." />
            <span asp-validation-for="Challenge.RewardDescription" class="text-danger"></span>
        </div>

        @if (!User.IsInRole("Admin"))
        {
            <div class="alert py-3 bg-opacity-10 border-info border-opacity-25 text-white small mb-4">
                <i class="bi bi-info-circle-fill me-2"></i>
                Yêu cầu của bạn sẽ được gửi tới Quản trị viên để phê duyệt trước khi công khai.
            </div>
        }

        <div class="d-flex justify-content-between mt-5 pt-3 border-top border-secondary border-opacity-20">
            <a asp-page="Index" class="btn btn-outline-light px-4 d-flex align-items-center" style="border-radius: 12px; border-color: rgba(255,255,255,0.2) !important;">
                <i class="bi bi-arrow-left me-2"></i> Quay lại
            </a>
            <button type="submit" class="btn btn-glass px-5 shadow-lg">Xác nhận tạo kèo</button>
        </div>
    </form>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script>
        $(document).ready(function() {
            function toggleFee() {
                var type = $('#type-select').val();
                // MiniGame = 1
                if (type == '1') { 
                    $('#entry-fee').closest('.col-md-4').css('opacity', '1');
                } else {
                    // Stay visible but maybe hint it's optional
                }
            }
            $('#type-select').change(toggleFee);
            toggleFee();
        });
    </script>
}
