@page
@model PickleballClub.Pages.Treasury.IndexModel
@using PickleballClub.Models

@{
    ViewData["Title"] = "Quản lý Tài chính";
}

<div class="mt-4 fade-in-up">
    <div class="row align-items-stretch">
        <div class="col-md-5 mb-4">
            <div class="glass-card text-center h-100 d-flex flex-column justify-content-center">
                <div class="text-label mb-3">Tổng quỹ CLB</div>
                <div class="stat-value mb-2">
                    @Model.TotalBalance.ToString("N0")đ
                </div>
                <div class="text-label opacity-50" style="letter-spacing: 0;">Cập nhật lúc: @DateTime.Now.ToString("HH:mm")</div>
            </div>
        </div>
        <div class="col-md-7 mb-4">
            @if (Model.TotalBalance < 0)
            {
                <div class="glass-card h-100 border-danger border-opacity-50 d-flex align-items-center justify-content-center" style="background: rgba(220, 53, 69, 0.08);">
                    <div class="text-center p-2">
                        <i class="bi bi-exclamation-octagon display-4 text-danger mb-3 d-block"></i>
                        <h4 class="mb-2 fw-bold text-danger">CẢNH BÁO: QUỸ ĐANG ÂM!</h4>
                        <p class="mb-0 text-white-50 small">Vui lòng thu tiền quỹ hoặc cắt giảm chi phí ngay.</p>
                    </div>
                </div>
            }
            else
            {
                <div class="glass-card h-100 d-flex flex-column justify-content-center border-success border-opacity-20">
                    <h5 class="text-success mb-3 fw-bold"><i class="bi bi-shield-check me-2"></i>Tài chính an toàn</h5>
                    <p class="text-white-50 small mb-4">Mọi hoạt động thu chi đang diễn ra theo đúng kế hoạch.</p>
                    <div class="progress" style="height: 6px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                        <div class="progress-bar bg-success" style="width: @(Math.Min(100, (Model.TotalBalance / 10000000) * 100))%"></div>
                    </div>
                </div>
            }
        </div>
    </div>

    <div class="glass-card">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold mb-0">Lịch sử Giao dịch</h3>
            <div class="d-flex gap-2">
                <a asp-page="CreateCategory" class="btn btn-sm btn-glass px-3">Danh mục</a>
                <a asp-page="Create" class="btn btn-glass btn-sm px-4">Thu/Chi</a>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table align-middle">
                <thead>
                    <tr>
                        <th>Ngày</th>
                        <th>Danh mục</th>
                        <th>Nội dung</th>
                        <th class="text-end">Số tiền</th>
                        @if (User.IsInRole("Admin"))
                        {
                            <th class="text-end">Hành động</th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Transactions) {
                        <tr>
                            <td class="small opacity-75">@item.TransactionDate.ToString("dd/MM HH:mm")</td>
                            <td>
                                <span class="badge @(item.TransactionCategory.Type == TransactionType.Income ? "badge-confirmed" : "badge-pending")">
                                    @item.TransactionCategory.CategoryName
                                </span>
                            </td>
                            <td class="small">@item.Description</td>
                            <td class="text-end fw-bold @(item.TransactionCategory.Type == TransactionType.Income ? "text-success" : "text-danger")">
                                @(item.TransactionCategory.Type == TransactionType.Income ? "+" : "-")@item.Amount.ToString("N0")đ
                            </td>
                            @if (User.IsInRole("Admin"))
                            {
                                <td class="text-end">
                                    <a asp-page="./Edit" asp-route-id="@item.Id" class="btn btn-sm btn-outline-warning me-1"><i class="bi bi-pencil"></i></a>
                                    <a asp-page="./Delete" asp-route-id="@item.Id" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></a>
                                </td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
}
